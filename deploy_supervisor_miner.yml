- hosts: all
  tasks:
    - name: add supervisor conf file
      template:
        src: miner.conf.j2
        dest: /etc/supervisor/conf.d/miner.conf
      become: true
    - name: fetch last code version
      shell: |
        cd /var/www/client && git pull
    - name: restart
      shell: sleep 2 && shutdown -r now
      async: 1
      poll: 0
      become: true
      ignore_errors: true
    - name: waiting for server to come back after reboot
      local_action: wait_for host={{ ansible_ssh_host }} state=started port={{ ansible_ssh_port }} delay=30 timeout=300 connect_timeout=15
